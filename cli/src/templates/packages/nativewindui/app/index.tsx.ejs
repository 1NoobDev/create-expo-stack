import * as React from 'react';
import { Button as RNButton, ButtonProps, FlatList, Linking, View } from 'react-native';

import { Text } from '@/components/nativewind-ui/Text';
import { useColorScheme } from '@/lib/useColorScheme';
import { useHeaderSearchBar } from '@/lib/useHeaderSearchBar';

function DefaultButton({ color, ...props }: ButtonProps) {
  const { colors } = useColorScheme();
  return <RNButton color={color ?? colors.blue} {...props} />;
}

export default function Screen() {
  const searchValue = useHeaderSearchBar();

  const data = searchValue
    ? COMPONENTS.filter((c) => c.name.toLowerCase().includes(searchValue.toLowerCase()))
    : COMPONENTS;

  const screens = searchValue
    ? FULL_SCREEN_COMPONENTS.filter((c) => c.name.toLowerCase().includes(searchValue.toLowerCase()))
    : FULL_SCREEN_COMPONENTS;

  return (
    <FlatList
      contentInsetAdjustmentBehavior="automatic"
      data={data}
      contentContainerClassName="flex flex-1 py-4 items-center justify-center"
      extraData={searchValue}
      removeClippedSubviews={false} // used for selecting text on android
      keyExtractor={(item) => item.name}
      ItemSeparatorComponent={() => <View className="p-2" />}
      renderItem={({ item }) => {
        return (
          <Card title={item.name}>
            <item.component />
          </Card>
        );
      }}
      ListEmptyComponent={() => {
        return (
          <View className='px-4'>
            <Text variant="title3" className="text-center font-bold">
              No Components Installed
            </Text>
            <Text color="tertiary" variant="body" className="text-center pb-4">
              You can install any of the free components from the NativeWindUI website.
            </Text>
            <DefaultButton title="Open NativeWindUI" onPress={() => Linking.openURL('https://nativewindui.com')} />
          </View>
        )
      }}
    />
  );
}

function Card({ children, title }: { children: React.ReactNode; title: string }) {
  return (
    <View className="px-4">
      <View className="bg-card border-border gap-4 rounded-xl border p-4 pb-6 shadow-sm shadow-black/10 dark:shadow-none">
        <Text className="text-center text-sm font-medium tracking-wider opacity-60">{title}</Text>
        {children}
      </View>
    </View>
  );
}

const COMPONENTS = [
] as const;

const FULL_SCREEN_COMPONENTS = [
  {
    name: 'Drawer Navigation',
    href: '/drawer/',
  },
  {
    name: 'Bottom Tabs Navigation',
    href: '/bottom-tabs/',
  },
  {
    name: 'Top Tabs Navigation',
    href: '/top-tabs/',
  },
] as const;
